{% extends "Rimborsi/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Missioni{% endblock %}

{% block h1title %}
    {% if missioni_passate %}
        Le mie missioni
    {% else %}
        Benvenuto! Effettua il <a href="{% url 'login' %}">login</a> per iniziare.
    {% endif %}
{% endblock %}


{% block content %}
    {% spaceless %}
        {% if user.is_authenticated %}
            {% if missioni_passate %}
                <table class="table table-striped">
                    <tbody>
                    {% for m in missioni_passate %}
                        <tr>
                            <td class="col-9">
                                <blockquote class="blockquote mb-0">
                                    {{ m.inizio|date:"d/m/Y" }} - {{ m.stato_destinazione }}
                                    - {{ m.citta_destinazione }}
                                </blockquote>
                                {#                                <btn>Cancella</btn>#}
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                   href="{% url 'RimborsiApp:resoconto' id=m.id %}"
                                   role="button">Resoconto</a>
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                   href="{% url 'RimborsiApp:missione' id=m.id %}"
                                   role="button">Modifica</a>
                            </td>
                            <td>
                                <a class="btn btn-danger"
                                   href="#"
                                   data-href="{% url 'RimborsiApp:cancella_missione' id=m.id %}"
                                   data-target="#confirm-delete"
                                   data-toggle="modal"
                                   role="button">Cancella</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <div id="confirm-delete" class="modal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Danger!!!</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>Vuoi davvero cancellare la missione?</p>
                            </div>
                            <div class="modal-footer">
                                <a class="btn btn-danger btn-ok">Sì</a>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    $('#confirm-delete').on('show.bs.modal', function (e) {
                        $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));
                    });
                </script>
            {% endif %}
        {% else %}

        {% endif %}

        <h1>News</h1>
        <p align="justify"><b>20/08/2019</b> - Autocompilazione modulo kasko attiva! Per poter usufruire del servizio è necessario, nell'ordine, installare
        il plugin del browser Tampermonkey (<a href="https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/" target="blank"><i class="fa fa-firefox" aria-hidden="true"></i></a>,
        <a href="https://addons.opera.com/en/extensions/details/tampermonkey-beta/" target="blank"><i class="fa fa-opera" aria-hidden="true"></i></a>,
        <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo//Open" target="blank"><i class="fa fa-chrome" aria-hidden="true"></i></a>)
        e installare <a href="https://raw.githubusercontent.com/prittt/missioni-unimore/master/autocompilatore_richieste_kasko.user.js">questo</a> script. Fatto ciò,
        quando cliccate sul link "kasko" nel resoconto missione si aprirà la pagina kasko di unimore con un pulsante speciale (Auto fill data from Tampermonkey storage).
        Non vi resta che creare una nuova entry e cliccare sul pulsante magico!</p>
        <p><b>19/08/2019</b> - Autocompilazione profilo utente con dati Shibboleth attiva.</p>


    {% endspaceless %}
{% endblock %}
