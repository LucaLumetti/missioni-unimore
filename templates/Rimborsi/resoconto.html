{% extends "Rimborsi/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Resoconto{% endblock %}
{% block h1title %}Resoconto Missione{% endblock %}


{% block content %}
    {% spaceless %}
        {% if user.is_authenticated %}
            {% if missione %}
                <form action="{% url 'genera_pdf' id=missione.id %}" method="post">{% csrf_token %}
                    <table class="table table-borderless table-sm rounded">
                        {{ moduli_missione_form.management_form }}
                        <tr>
                            <td class="table-primary">
                                {{ moduli_missione_form.parte_1|as_crispy_field }}
                            </td>
                            <td class="table-secondary">
                                {{ moduli_missione_form.parte_2|as_crispy_field }}
                            </td>
                            <td class="table-success">
                                {{ moduli_missione_form.kasko|as_crispy_field }}
                            </td>
                            <td class="table-warning">
                                {{ moduli_missione_form.dottorandi|as_crispy_field }}
                            </td>
                        </tr>
                        <tr align="center">
                            <td class="table-primary">
                                {% if missione.modulimissione.parte_1_file %}
                                    <a class="download" href="{{ missione.modulimissione.parte_1_file.url }}"
                                       target="_blank"> <i class="fa fa-file-pdf-o fa-2x"></i> Missione Parte I</a>
                                {% else %}
                                    <p>Missione Parte I</p>
                                {% endif %}
                            </td>
                            <td class="table-secondary">
                                {% if missione.modulimissione.parte_2_file %}
                                    <a class="download" href="{{ missione.modulimissione.parte_2_file.url }}"
                                       target="_blank"><i class="fa fa-file-word-o fa-2x"></i> Missione Parte II</a>
                                {% else %}
                                    <p>Missione Parte II</p>
                                {% endif %}
                            </td>
                            <td class="table-success">
                                {% if missione.modulimissione.kasko_file %}
                                    <a class="download" href="{{ missione.modulimissione.kasko_file.url }}"
                                       target="_blank"><i class="fa fa-file-pdf-o fa-2x"></i> Kasko</a>
                                {% else %}
                                    <p>Kasko</p>
                                {% endif %}
                            <td class="table-warning">
                                {% if missione.modulimissione.dottorandi_file %}
                                    <a class="download" href="{{ missione.modulimissione.dottorandi_file.url }}"
                                       target="_blank"><i class="fa fa-file-pdf-o fa-2x"></i> Autorizzazione Dottorando</a>
                                {% else %}
                                    <p>Autorizzazione Dottorando</p>
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                    <input class="btn btn-primary" type="submit" value="Compila PDF">

                    {#                    <a class="btn btn-primary" href="{% url 'compila_parte_1' id=missione.id %}" role="button">Compila#}
                    {#                        PDF</a>#}
                </form>

                <p>km percorsi: {{ km|floatformat:2 }}</p>
                <p>Indennità totale: {{ indennita|floatformat:2 }} €</p>
            {% endif %}
        {% endif %}

        <style>
            a.download {
                text-decoration: none;
                color: #212529;
            }
        </style>
    {% endspaceless %}
{% endblock %}

