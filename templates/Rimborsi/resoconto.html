{% extends "Rimborsi/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Resoconto{% endblock %}
{% block h1title %}Resoconto Missione{% endblock %}


{% block content %}
    {% spaceless %}
        {% if user.is_authenticated %}
            {% if missione %}
                <table class="table table-sm table-borderless">
                    <tbody>
                    <tr>
                        <td>Trasporto</td>
                        <td>{{ totali.trasporto |floatformat:2 }} €</td>
                    </tr>
                    <tr>
                        <td>Pasti</td>
                        <td>{{ totali.scontrino |floatformat:2 }} €</td>
                    </tr>
                    <tr>
                        <td>Pernottamenti</td>
                        <td>{{ totali.pernottamento |floatformat:2 }} €</td>
                    </tr>
                    <tr>
                        <td>Convegni</td>
                        <td>{{ totali.convegno |floatformat:2 }} €</td>
                    </tr>
                    <tr class="bordered">
                        <td>Altro</td>
                        <td>{{ totali.altrespese |floatformat:2 }} €</td>
                    </tr>
                    </tbody>
                    <tr>
                        <td class="right"><b>Totale</b></td>
                        <td>{{ totali.totale |floatformat:2 }} €</td>
                    </tr>
                    <tr class="bordered">
                        <td>Indennità Chilometrica ({{ km|floatformat:2 }} km)</td>
                        <td>{{ indennita|floatformat:2 }} €</td>
                    </tr>
                    <tfoot>
                    <tr>
                        <td class="right"><b>Totale</b></td>
                        <td>{{ totali.totale_indennita|floatformat:2 }} €</td>
                    </tr>
                    </tfoot>
                </table>
                <form action="{% url 'genera_pdf' id=missione.id %}" method="post">{% csrf_token %}
                    <table id="table-moduli" class="table table-borderless table-sm rounded">
                        {{ moduli_missione_form.management_form }}
                        <tr class="center">
                            <td class="table-primary">
                                {{ moduli_missione_form.parte_1|as_crispy_field }}
                            </td>
                            <td class="table-secondary">
                                {{ moduli_missione_form.parte_2|as_crispy_field }}
                            </td>
                            <td class="table-success">
                                {{ moduli_missione_form.kasko|as_crispy_field }}
                            </td>
                            {% if user.profile.qualifica == 'DOTTORANDO' %}
                                <td class="table-warning">
                                    {{ moduli_missione_form.dottorandi|as_crispy_field }}
                                </td>
                            {% endif %}
                        </tr>
                        <tr class="center">
                            <td class="table-primary">
                                {% if missione.modulimissione.parte_1_file %}
                                    <a class="download" href="{{ missione.modulimissione.parte_1_file.url }}"
                                       target="_blank"> <i class="fa fa-file-pdf-o fa-2x"></i> Missione Parte I</a>
                                {% else %}
                                    <p>Missione Parte I</p>
                                {% endif %}
                            </td>
                            <td class="table-secondary">
                                {% if missione.modulimissione.parte_2_file %}
                                    <a class="download" href="{{ missione.modulimissione.parte_2_file.url }}"
                                       target="_blank"><i class="fa fa-file-word-o fa-2x"></i> Missione Parte II</a>
                                {% else %}
                                    <p>Missione Parte II</p>
                                {% endif %}
                            </td>
                            <td class="table-success">
                                {% if missione.modulimissione.kasko_file %}
                                    <a class="download" href="{{ missione.modulimissione.kasko_file.url }}"
                                       target="_blank"><i class="fa fa-file-pdf-o fa-2x"></i> Kasko</a>
                                {% else %}
                                    <p>Kasko</p>
                                {% endif %}
                            </td>
                            {% if user.profile.qualifica == 'DOTTORANDO' %}
                                <td class="table-warning center">
                                    {% if missione.modulimissione.dottorandi_file %}
                                        <a class="download" href="{{ missione.modulimissione.dottorandi_file.url }}"
                                           target="_blank"><i class="fa fa-file-pdf-o fa-2x"></i> Autorizzazione
                                            Dottorando</a>
                                    {% else %}
                                        <p>Autorizzazione Dottorando</p>
                                    {% endif %}
                                </td>
                            {% endif %}
                        </tr>
                        <tr>
                            <td class="table-info center">
                                {{ moduli_missione_form.atto_notorio|as_crispy_field }}
                            </td>
                            <td class="table-info" rowspan="2"
                                colspan=" {% if user.profile.qualifica == 'DOTTORANDO' %}3{% else %}2{% endif %}">
                                {{ moduli_missione_form.dichiarazione_check_std|as_crispy_field }}
                                {{ moduli_missione_form.dichiarazione_check_pers|as_crispy_field }}
                                {{ moduli_missione_form.atto_notorio_dichiarazione|as_crispy_field }}
                            </td>
                        </tr>
                        <tr>
                            <td class="table-info center">
                                {% if missione.modulimissione.atto_notorio_file %}
                                    <a class="download" href="{{ missione.modulimissione.atto_notorio_file.url }}"
                                       target="_blank"><i class="fa fa-file-pdf-o fa-2x"></i> Atto Notorio</a>
                                {% else %}
                                    <p>Atto di notorietà</p>
                                {% endif %}
                            </td>
                        </tr>

                    </table>
                    <input class="btn btn-primary" type="submit" value="Compila PDF">

                    {#                    <a class="btn btn-primary" href="{% url 'compila_parte_1' id=missione.id %}" role="button">Compila#}
                    {#                        PDF</a>#}
                </form>

            {% endif %}
        {% endif %}

        <script>
        $('#id_dichiarazione_check_pers').change(function () {
            $('#id_atto_notorio_dichiarazione').prop('disabled', function(i, v) { return !v; });
        })
        </script>
        <style>
            a.download {
                text-decoration: none;
                color: #212529;
            }

            .center {
                text-align: center;
                vertical-align: center;
            }

            .right {
                text-align: right;
            }

            tr.bordered {
                border-bottom: 1px solid #dee2e6;
            }
        </style>
    {% endspaceless %}
{% endblock %}

